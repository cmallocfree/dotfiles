# One word aliases.
command alias alias command alias
alias import command script import
alias shell platform shell
alias history command history
alias disable breakpoint disable

# Breakpoint helpers.
alias condition breakpoint modify --condition %1
alias ignore breakpoint modify --ignore-count %1
alias mainthread breakpoint modify --thread-index 1
command regex autocontinue
s/^$/breakpoint modify --auto-continue true/
s/.*/breakpoint modify --auto-continue %1/

# List registers, with calling convention.
alias args register read arg1 arg2 arg3 arg4 arg5 arg6

# Like `p` and `po`, but for variables not full expressions.
alias v frame variable
alias vo frame variable -O --

# Globally set expression language.
alias swift settings set target.language swift

command regex let
s/(.+): (.+) = (0x[[:xdigit:]]{10,})/call weak var $%1 = unsafeBitCast(%3, to: %2.self)/
s/(.+) = (0x[[:xdigit:]]{10,})/call weak var $%1 = unsafeBitCast(%2, to: AnyObject.self)/
s/(.+) = (.+)/call weak var $%1 = %2/

command regex po
s/(.*0x[[:xdigit:]]{10,}.*)/expression -l objc -O -- %1/
s/(.*)/expression -O -- %1/

# Use `f` for both `finish` and `frame select`.
command regex f
s/^$/finish/
s/(\d+)/frame select %1/

# Convenience `breakpoint command add` helper. See gdb's `commands`.
command regex commands
s/(-.+)/breakpoint command add %1/
s/(.+) (\d+)$/breakpoint command add -s python -o '%1' %2/
s/(.+)/breakpoint command add -s python -o "%1"/

# Xcode calls breakpoint commands "actions"
alias action commands

# Convenience `help` command that works for Python API too.
command regex h
s/^(lldb(?:\..+)?)/script help(%1)/
s/^(SB.+)/script help(lldb.%1)/
s/(.*)/help %1/

# Mnemonic friendly symbol lookup.
#   lookup 0xabcdef00
#   lookup /pattern/
#   lookup exact_name
command regex lookup
s/(0x[[:xdigit:]]+)/image lookup -a %1/
s/\x2f(.+)\x2f?$/image lookup -r -n %1/
s/(.+)/image lookup -n %1/

command regex stop-hook
s/^$/target stop-hook list/
s/(-.+)/target stop-hook add %1/
s/(.+)/target stop-hook %1/

# Reload python modules, for lldb command development.
command regex reload 's/(.+)/script reload(%1)/'

settings set stop-disassembly-count 8

# https://github.com/facebook/chisel
import /usr/local/opt/chisel/libexec/fblldb.py
# https://github.com/kastiglione/lldb-helpers
import ~/src/lldb-helpers/criteria.py

# Extra config
command source ~/.lldbinit-local
